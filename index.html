<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#1e293b">
    <title>Vehicle Tracker</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiVmVoaWNsZSBUcmFja2VyIiwic2hvcnRfbmFtZSI6IlZlaGljbGVUcmFja2VyIiwiZGVzY3JpcHRpb24iOiJUcmFjayB2ZWhpY2xlIGFuZCBlbGV2YXRvciBtb3ZlbWVudHMiLCJzdGFydF91cmwiOiIuLyIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiMxZTI5M2IiLCJ0aGVtZV9jb2xvciI6IiMxZTI5M2IiLCJpY29ucyI6W3sic3JjIjoiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhkcFpIUm9QU0l5TkRBaUlHaGxhV2RvZEQwaU1qUXdJajQ4Y21WamRDQjNhV1IwYUQwaU1qUXdJaUJvWldsbmFIUTlJakkwTUNJZ1ptbHNiRDBpSXpGbE1qa3lZbUlpTHo0OGNHRjBhQ0JrUFNKTk1USXdJRFl3WXpBdE16TXVNVFF0TWpZdU9EWXROakF0TmpBdE5qQlRPRFkyUXpNeVF6RXlNQ0F5Tmk0NE5pQXhNakFnTmpCYVRURTJNQ0F4TURCRE16TXVNVFFnTUNBMk1DQXlOaTQ0TmlBMk1DQTJNSE10TWpZdU9EWWdOakF0TmpBZ05qQmFJaUJtYVd4c1BTSjNhR2wwWlNJdlBqd3ZjM1puUGc9PSIsInNpemVzIjoiMjQweDI0MCIsInR5cGUiOiJpbWFnZS9zdmcreG1sIn1dfQ==">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: white;
            min-height: 100vh;
        }
        .container { max-width: 400px; margin: 0 auto; padding: 20px; }
        .header { 
            background: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #374151;
            position: sticky;
            top: 0;
            z-index: 10;
            padding: 16px 20px;
        }
        .header-content { 
            max-width: 400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .title { display: flex; align-items: center; gap: 8px; font-size: 20px; font-weight: bold; }
        .btn { 
            padding: 12px 16px;
            border: none;
            border-radius: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        .btn:hover { transform: translateY(-1px); }
        .btn-green { background: #16a34a; color: white; }
        .btn-green:hover { background: #15803d; }
        .btn-red { background: #dc2626; color: white; }
        .btn-red:hover { background: #b91c1c; }
        .btn-purple { background: #9333ea; color: white; }
        .btn-purple:hover { background: #7c3aed; }
        .btn-orange { background: #ea580c; color: white; }
        .btn-orange:hover { background: #c2410c; }
        .btn-yellow { background: #eab308; color: white; }
        .btn-yellow:hover { background: #ca8a04; }
        .btn-gray { background: #475569; color: #cbd5e1; }
        .btn-gray:hover { background: #334155; }
        .btn-active { background: #3b82f6 !important; color: white !important; }
        .btn-small { padding: 4px 8px; font-size: 12px; }
        .card { 
            background: rgba(30, 41, 59, 0.5);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 24px;
        }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .section-title { 
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .toggle { 
            display: flex;
            background: #1e293b;
            border-radius: 12px;
            padding: 4px;
            margin-bottom: 24px;
        }
        .toggle button { 
            flex: 1;
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            background: transparent;
            color: #94a3b8;
            cursor: pointer;
            transition: all 0.2s;
        }
        .event-item { 
            background: #374151;
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }
        .event-item:hover .event-controls { opacity: 1; }
        .event-content { display: flex; align-items: center; gap: 12px; }
        .event-controls { 
            display: flex;
            align-items: center;
            gap: 8px;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .event-time { 
            color: #cbd5e1;
            font-size: 14px;
            cursor: pointer;
            padding: 2px 6px;
            border-radius: 4px;
        }
        .event-time:hover { background: rgba(59, 130, 246, 0.2); color: #60a5fa; }
        .time-input { 
            background: transparent;
            border: 1px solid #475569;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
            width: 60px;
        }
        .time-input:focus { outline: none; border-color: #3b82f6; }
        .icon { width: 16px; height: 16px; border-radius: 50%; }
        .icon-green { background: #16a34a; }
        .icon-red { background: #dc2626; }
        .icon-purple { background: #9333ea; }
        .icon-orange { background: #ea580c; }
        .stats { 
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 16px;
        }
        .stat-card { 
            background: rgba(30, 41, 59, 0.5);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
        }
        .stat-number { font-size: 24px; font-weight: bold; margin-bottom: 4px; }
        .stat-label { font-size: 12px; color: #94a3b8; }
        .chart-placeholder {
            background: rgba(55, 65, 81, 0.5);
            border-radius: 8px;
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6b7280;
            font-size: 14px;
        }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="title">
                <span>üöó</span>
                <span>Vehicle Tracker</span>
            </div>
            <button class="btn btn-small btn-green" onclick="exportData()">üì•</button>
        </div>
    </div>

    <div class="container">
        <div class="toggle">
            <button id="todayBtn" class="btn-active" onclick="showView('today')">Today</button>
            <button id="dashboardBtn" onclick="showView('dashboard')">Dashboard</button>
        </div>

        <div id="todayView">
            <div class="card">
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                    <span>üìÖ</span>
                    <span style="color: #94a3b8;">Today</span>
                </div>
                <div style="font-size: 24px; font-weight: bold;" id="currentDate"></div>
            </div>

            <div style="margin-bottom: 24px;">
                <div class="section-title">
                    <span>üöó</span>
                    <span>Vehicle Tracking</span>
                </div>
                <div class="grid-2">
                    <button class="btn btn-green" onclick="logEvent('in', 'vehicle')">
                        <span>üöó</span>
                        <span>Car In</span>
                    </button>
                    <button class="btn btn-red" onclick="logEvent('out', 'vehicle')">
                        <span>üöó</span>
                        <span>Car Out</span>
                    </button>
                </div>
            </div>

            <div style="margin-bottom: 24px;">
                <div class="section-title">
                    <span>üõó</span>
                    <span>Elevator Tracking</span>
                </div>
                <div class="grid-2">
                    <button class="btn btn-purple" onclick="logEvent('in', 'elevator')">
                        <span>üõó</span>
                        <span>Elevator In</span>
                    </button>
                    <button class="btn btn-orange" onclick="logEvent('out', 'elevator')">
                        <span>üõó</span>
                        <span>Elevator Out</span>
                    </button>
                </div>
            </div>

            <div style="margin-bottom: 24px;">
                <div class="section-title">
                    <span>üí°</span>
                    <span>Evening Light</span>
                </div>
                <div class="grid-2">
                    <button class="btn" id="lightOnBtn" onclick="toggleLight('on')">
                        <span>üí°</span>
                        <span>Light On</span>
                    </button>
                    <button class="btn" id="lightOffBtn" onclick="toggleLight('off')">
                        <span>üí°</span>
                        <span>Light Off</span>
                    </button>
                </div>
            </div>

            <div class="card">
                <div class="section-title">
                    <span>üïê</span>
                    <span>Today's Activity</span>
                </div>
                <div id="activityList"></div>
            </div>
        </div>

        <div id="dashboardView" class="hidden">
            <div class="card">
                <div class="section-title">
                    <span>üìà</span>
                    <span>7-Day Activity</span>
                </div>
                <div class="chart-placeholder">Activity Chart (Last 7 Days)</div>
            </div>

            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" style="color: #3b82f6;" id="vehicleTotal">0</div>
                    <div class="stat-label">Vehicle Trips (7 days)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" style="color: #9333ea;" id="elevatorTotal">0</div>
                    <div class="stat-label">Elevator Trips (7 days)</div>
                </div>
            </div>

            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" style="color: #16a34a;" id="totalTrips">0</div>
                    <div class="stat-label">Total Trips (7 days)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" style="color: #eab308;" id="lightDays">0</div>
                    <div class="stat-label">Days Light On</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let data = {};
        let currentView = 'today';
        let editingEvent = null;
        const today = new Date().toISOString().split('T')[0];

        // Load data
        function loadData() {
            const saved = localStorage.getItem('vehicleTrackerData');
            data = saved ? JSON.parse(saved) : {};
        }

        // Save data
        function saveData() {
            localStorage.setItem('vehicleTrackerData', JSON.stringify(data));
        }

        // Get today's data
        function getTodayData() {
            return data[today] || {
                date: today,
                vehicleEvents: [],
                elevatorEvents: [],
                eveningLight: { status: 'not_recorded', time: null }
            };
        }

        // Log event
        function logEvent(type, category) {
            const now = new Date();
            const timeString = now.toTimeString().slice(0, 5);
            const eventKey = category === 'vehicle' ? 'vehicleEvents' : 'elevatorEvents';
            
            if (!data[today]) data[today] = getTodayData();
            
            data[today][eventKey].push({
                type: type,
                time: timeString,
                timestamp: now.toISOString()
            });
            
            saveData();
            updateDisplay();
        }

        // Update event time
        function updateEventTime(category, index, newTime) {
            const eventKey = category === 'vehicle' ? 'vehicleEvents' : 'elevatorEvents';
            data[today][eventKey][index].time = newTime;
            saveData();
            updateDisplay();
        }

        // Delete event
        function deleteEvent(category, index) {
            const eventKey = category === 'vehicle' ? 'vehicleEvents' : 'elevatorEvents';
            data[today][eventKey].splice(index, 1);
            saveData();
            updateDisplay();
        }

        // Toggle light
        function toggleLight(status) {
            const now = new Date();
            const timeString = now.toTimeString().slice(0, 5);
            
            if (!data[today]) data[today] = getTodayData();
            
            data[today].eveningLight = {
                status: status,
                time: timeString,
                timestamp: now.toISOString()
            };
            
            saveData();
            updateDisplay();
        }

        // Clear light
        function clearLight() {
            if (!data[today]) data[today] = getTodayData();
            data[today].eveningLight = { status: 'not_recorded', time: null };
            saveData();
            updateDisplay();
        }

        // Export data
        function exportData() {
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `vehicle-tracker-${today}.json`;
            link.click();
        }

        // Show view
        function showView(view) {
            currentView = view;
            document.getElementById('todayView').classList.toggle('hidden', view !== 'today');
            document.getElementById('dashboardView').classList.toggle('hidden', view !== 'dashboard');
            document.getElementById('todayBtn').classList.toggle('btn-active', view === 'today');
            document.getElementById('dashboardBtn').classList.toggle('btn-active', view === 'dashboard');
            
            if (view === 'dashboard') {
                updateDashboard();
            }
        }

        // Update display
        function updateDisplay() {
            const todayData = getTodayData();
            
            // Update current date
            document.getElementById('currentDate').textContent = new Date().toLocaleDateString('en', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            // Update light buttons
            const lightOnBtn = document.getElementById('lightOnBtn');
            const lightOffBtn = document.getElementById('lightOffBtn');
            
            lightOnBtn.className = 'btn ' + (todayData.eveningLight.status === 'on' ? 'btn-yellow' : 'btn-gray');
            lightOffBtn.className = 'btn ' + (todayData.eveningLight.status === 'off' ? 'btn-gray' : 'btn-gray');

            // Update activity list
            const activityList = document.getElementById('activityList');
            let html = '';

            // Vehicle events
            todayData.vehicleEvents.forEach((event, index) => {
                const iconClass = event.type === 'in' ? 'icon-green' : 'icon-red';
                html += `
                    <div class="event-item">
                        <div class="event-content">
                            <div class="icon ${iconClass}"></div>
                            <span>Vehicle ${event.type}</span>
                        </div>
                        <div class="event-controls">
                            <span class="event-time" onclick="editTime('vehicle', ${index}, '${event.time}')">${event.time}</span>
                            <button class="btn btn-small" onclick="deleteEvent('vehicle', ${index})" style="background: rgba(220, 38, 38, 0.2); color: #f87171;">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
            });

            // Elevator events
            todayData.elevatorEvents.forEach((event, index) => {
                const iconClass = event.type === 'in' ? 'icon-purple' : 'icon-orange';
                html += `
                    <div class="event-item">
                        <div class="event-content">
                            <div class="icon ${iconClass}"></div>
                            <span>Elevator ${event.type}</span>
                        </div>
                        <div class="event-controls">
                            <span class="event-time" onclick="editTime('elevator', ${index}, '${event.time}')">${event.time}</span>
                            <button class="btn btn-small" onclick="deleteEvent('elevator', ${index})" style="background: rgba(220, 38, 38, 0.2); color: #f87171;">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
            });

            // Light status
            if (todayData.eveningLight.status !== 'not_recorded') {
                html += `
                    <div class="event-item">
                        <div class="event-content">
                            <div class="icon" style="background: #eab308;"></div>
                            <span>Evening Light ${todayData.eveningLight.status}</span>
                        </div>
                        <div class="event-controls">
                            <span class="event-time">${todayData.eveningLight.time}</span>
                            <button class="btn btn-small" onclick="clearLight()" style="background: rgba(220, 38, 38, 0.2); color: #f87171;">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
            }

            if (html === '') {
                html = '<p style="color: #94a3b8; font-size: 14px;">No activity recorded today</p>';
            }

            activityList.innerHTML = html;
        }

        // Edit time
        function editTime(category, index, currentTime) {
            const newTime = prompt('Enter new time (HH:MM):', currentTime);
            if (newTime && newTime.match(/^\d{2}:\d{2}$/)) {
                updateEventTime(category, index, newTime);
            }
        }

        // Update dashboard
        function updateDashboard() {
            let vehicleTotal = 0;
            let elevatorTotal = 0;
            let lightDays = 0;

            // Calculate last 7 days
            for (let i = 0; i < 7; i++) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                const dayData = data[dateStr];

                if (dayData) {
                    vehicleTotal += dayData.vehicleEvents?.length || 0;
                    elevatorTotal += dayData.elevatorEvents?.length || 0;
                    if (dayData.eveningLight?.status === 'on') lightDays++;
                }
            }

            document.getElementById('vehicleTotal').textContent = vehicleTotal;
            document.getElementById('elevatorTotal').textContent = elevatorTotal;
            document.getElementById('totalTrips').textContent = vehicleTotal + elevatorTotal;
            document.getElementById('lightDays').textContent = lightDays;
        }

        // Register service worker
        if ('serviceWorker' in navigator) {
            const swCode = `
                const CACHE_NAME = 'vehicle-tracker-v1';
                self.addEventListener('install', event => {
                    event.waitUntil(caches.open(CACHE_NAME));
                });
                self.addEventListener('fetch', event => {
                    event.respondWith(
                        caches.match(event.request).then(response => response || fetch(event.request))
                    );
                });
            `;
            const blob = new Blob([swCode], { type: 'application/javascript' });
            const swUrl = URL.createObjectURL(blob);
            navigator.serviceWorker.register(swUrl).catch(() => {});
        }

        // Initialize
        loadData();
        updateDisplay();
    </script>
</body>
</html>
